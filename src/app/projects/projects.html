<div class="flex flex-col gap-4 rounded-xl w-full">
  <div class="container sm:px-6 lg:px-8 bg-white grid grid-col-1 grap-4">
    <div class="mb-2 border-b border-gray-300 pb-1">
      <div class="page-title mt-2 text-2xl font-bold text-gray-800 mb-10">
        <i class=""><h2>LISTE DES PROJETS</h2></i>
      </div>
      <div class="flex gap-2 mb-4 justify-between">
        <button
          class="px-3 py-2 bg-black text-white rounded-[10px] hover:bg-gray-800 transition-colors"
          (click)="openCreateProjectModal()"
        >
          <i class="fas fa-plus mr-2"></i>Nouveau projet
        </button>
      </div>
      <!-- Formulaire de recherche -->
      <div class="bg-gradient-to-br from-slate-50 to-slate-100 border border-slate-200 shadow-sm p-4 rounded-lg mb-6">
        <h3 class="text-lg font-semibold text-slate-700 mb-4 flex items-center">
          <i class="fas fa-search mr-2 text-blue-600"></i>Rechercher des projets
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <!-- Recherche par nom -->
          <div class="transition-all duration-200 ease-in-out">
            <label class="block text-sm font-medium text-slate-700 mb-1">
              <i class="fas fa-project-diagram text-slate-500 mr-1"></i>Nom du projet
            </label>
            <!-- [(ngModel)]="searchForm.name"
                (input)="onSearchChange()" -->
            <div class="relative">
              <input
                type="text"
                placeholder="Rechercher par nom..."
                class="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-slate-400 placeholder-slate-400"
              />
              <!-- @if (Loading() && searchForm.name.trim()) {
                <div class="absolute right-2 top-2">
                  <i class="fas fa-spinner fa-spin text-blue-500"></i>
                </div>
              } -->
            </div>
          </div>

          <!-- Recherche par description -->
          <div class="transition-all duration-200 ease-in-out">
            <label class="block text-sm font-medium text-slate-700 mb-1">
              <i class="fas fa-align-left text-slate-500 mr-1"></i>Description
            </label>
            <div class="relative">
              <input
                type="text"
                placeholder="Rechercher par description..."
                class="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-slate-400 placeholder-slate-400"
              />
              <!-- [(ngModel)]="searchForm.status" -->


              <!-- @if (Loading() && searchForm.description.trim()) {
                <div class="absolute right-2 top-2">
                  <i class="fas fa-spinner fa-spin text-blue-500"></i>
                </div>
              } -->
            </div>
          </div>

          <!-- Filtre par statut -->
          <div class="transition-all duration-200 ease-in-out">
            <label class="block text-sm font-medium text-slate-700 mb-1">
              <i class="fas fa-tags text-slate-500 mr-1"></i>Statut
            </label>
            <select
              class="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-slate-400"
            >
              <option value="">Tous les statuts</option>
              <option value="Terminé">Terminé</option>
              <option value="En_cours">En cours</option>
              <option value="Pause">Pause</option>
              <option value="Prévisionnel">Prévisionnel</option>
            </select>
          </div>

          <!-- Filtre par budget -->
          <div class="transition-all duration-200 ease-in-out">
            <label class="block text-sm font-medium text-slate-700 mb-1">
              <i class="fas fa-wallet text-slate-500 mr-1"></i>Budget maximum
            </label>
            <div class="relative">
              <input
                type="number"
                placeholder="Budget max..."
                min="0"
                step="100"
                class="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-slate-400 placeholder-slate-400"
              />
              <!-- @if (Loading() && searchForm.maxBudget !== null && searchForm.maxBudget > 0) {
                <div class="absolute right-2 top-2">
                  <i class="fas fa-spinner fa-spin text-blue-500"></i>
                </div>
              } -->
            </div>
          </div>
        </div>

        <!-- Boutons d'action -->
        <div class="flex gap-2 mt-4">
          <button
            class="px-4 py-2 bg-slate-500 text-white rounded-md hover:bg-slate-600 transition-all duration-200 flex items-center font-medium hover:transform hover:-translate-y-0.5 hover:shadow-md"
          >
            <i class="fas fa-times mr-2"></i>Effacer
          </button>
          <button
            class="px-4 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700 transition-all duration-200 flex items-center font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:transform hover:-translate-y-0.5 hover:shadow-md"
          >
            <i class="fas fa-download mr-2"></i>Exporter
          </button>
        </div>

        <!-- Résumé des résultats -->
        <div class="mt-3 p-2 bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded text-sm text-blue-700">
          <i class="fas fa-info-circle mr-1"></i>
          Résultats de recherche disponibles
        </div>
      </div>
    </div>
    @if (Loading()) {
      <div class="flex justify-center items-center h-48">
        <div class="text-xl text-gray-600">Chargement des projets...</div>
      </div>
    } @else if (error()){
      <div
        class="p-4 bg-red-100 border border-red-400 text-red-700 rounded-md"
        role="alert"
      >
        <strong class="font-bold">Erreur !</strong>
        <span class="block sm:inline">Une erreur est survenue : {{ error() }}</span>
      </div>
    } @else {
        @if (projects().length) {
          <div
            class="overflow-x-auto w-full"
          >
            <table
              class="text-sm text-left text-gray-500 dark:text-gray-400 w-full"
            >
              <thead
                class="overflow-auto text-xs text-gray-700 uppercase bg-gray-400 dark:bg-gray-700 dark:text-gray-800"
              >
                <tr>
                  <th class="p-2 text-left text-sm text-gray-500 border-gray-300">
                    <input title="cocher" type="checkbox" />
                  </th>
                  <th scope="col" class="px-6 py-3">
                    <i class="fas fa-project-diagram mr-1"></i>
                    Nom
                  </th>
                  <th scope="col" class="px-6 py-3">
                    <i class="fas fa-align-left mr-1"></i>
                    Description
                  </th>
                  <th scope="col" class="px-6 py-3">
                    <i class="fas fa-calendar-alt mr-1"></i>
                    Estimation
                  </th>
                  <th scope="col" class="px-6 py-3"><i class="fas fa-tags mr-1"></i>Statut</th>
                  <th scope="col" class="px-6 py-3"><i class="fas fa-wallet mr-1"></i>Budget total</th>
                  <th scope="col" class="px-6 py-3"><i class="fas fa-tasks mr-1"></i>Activité</th>
                  <th scope="col" class="px-6 py-3"><i class="fas fa-cogs mr-1"></i>Action</th>
                </tr>
              </thead>
              <tbody>
                @for (project of projects(); track project) {
                <tr
                  class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"
                >
                  <td class="p-2 border border-l-0 border-r-0 border-gray-300">
                    <input title="cocher la case" type="checkbox" />
                  </td>
                  <td
                    class="px-6 py-4 font-medium text-gray-900"
                  >
                    {{ project.name }}
                  </td>
                  <td class="px-6 py-4">{{ project.description }}</td>
                  <td class="px-6 py-4 rounded-2xl">
                    {{ project.startDate | date:'fullDate':'':'fr'}} - {{ project.endDate |
                    date:'fullDate':'':'fr'}}
                  </td>
                  <td class="py-4">
                    <span
                      class="priority-label px-2 py-1 rounded bg-gray-100 text-gray-700"
                      [class.bg-green-200]="project.status.trim() === 'Terminé'"
                      [class.text-green-800]="project.status.trim() === 'Terminé'"
                      [class.bg-yellow-200]="project.status.trim() === 'En_cours'"
                      [class.text-yellow-800]="project.status.trim() === 'En_cours'"
                      [class.bg-red-200]="project.status.trim() === 'Pause'"
                      [class.text-red-800]="project.status.trim() === 'Pause'"
                      [class.bg-gray-200]="project.status.trim() === 'Prévisionnel'"
                      [class.text-gray-800]="project.status.trim() === 'Prévisionnel'"
                    >
                      {{ project.status }}
                    </span>
                  </td>
                  <td class="px-6 py-4">
                    {{ project.totalBudget | currency:'USD':'symbol':'1.2-2' }}
                  </td>
                  <td class="px-6 py-4">
                    <a
                      [routerLink]="['/projects-management/project-activities', project.id, project.name]"
                      title="Activités associées à ce projet"
                      class="px-3 py-1 bg-black text-white rounded hover:bg-gray-800 inline-block"
                    >
                      Activités
                    </a>
                  </td>
                  <td class="py-6 px-4 flex space-x-2">
                    <button title="Mise à jour du projet" class="text-blue-500" (click)="openEditProjectModal(project)">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button
                      title="Voir les détails du projet"
                      (click)="viewDetails(project)"
                    >
                      <i class="fas fa-eye"></i>
                    </button>
                    <button title="Supprimer le projet" class="text-red-500" (click)="openDeleteProjectConfirmation(project)">
                      <i class="fas fa-trash-alt"></i>
                    </button>
                  </td>
                </tr>
                }
              </tbody>
            </table>
          </div>
        } @else {
          <div class="flex justify-center items-center h-48">
            <div class="text-xl text-gray-600">Aucun projet trouvé.</div>
          </div>
        }
      }
      <div class="flex justify-end items-center gap-4 mt-8">
        <button
          (click)="previousPage()"
          [disabled]="currentPage() === 0"
          title="Précédent"
          class="p-2 rounded-full disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-black focus:ring-opacity-75 transition duration-150 ease-in-out"
        >
          <i class="fas fa-chevron-left text-black hover:text-black"></i>
        </button>
        <span class="text-gray-700 font-medium">
          Page {{ currentPage() + 1 }} sur {{ totalPages() }}
        </span>
        <button
          (click)="nextPage()"
          [disabled]="currentPage() === totalPages() - 1"
          title="Suivant"
          class="p-2 rounded-full disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-black focus:ring-opacity-75 transition duration-150 ease-in-out"
        >
          <i class="fas fa-chevron-right text-black hover:text-black"></i>
        </button>
      </div>
  </div>
</div>

@if (showDetailsModal() && selectedProject()) {
  <div class="fixed inset-0 z-50 flex">
    <div
      class="fixed inset-0 backdrop-contrast-50"
      (click)="closeDetailsModal()"
    ></div>
    <div class="relative ml-auto w-[800px] h-full bg-white shadow-xl z-50">
      <app-detail-project
        [project]="selectedProject()!"
        (closeModalDetail)="closeDetailsModal()"
        (responsiblesUpdated)="refreshProjectDetails()"
      ></app-detail-project>
    </div>
  </div>
}

@if (showProjectFormModal()) {
  <app-form-modal
    [project]="projectToEdit()"
    (save)="handleSaveProject($event)"
    (cancel)="closeProjectFormModal()"
  ></app-form-modal>
}

@if (showConfirmationModal()) {
  <app-confirmation-modal
    [message]="'Voulez-vous vraiment supprimer le projet ' + projectToDelete()?.name + '?'"
    (confirm)="handleConfirmDelete()"
    (cancel)="closeConfirmationModal()"
  ></app-confirmation-modal>
}

@if (showErrorMessageModal()) {
  <app-error-message-modal
    [message]="deletionErrorMessage()!"
    (close)="closeErrorMessageModal()"
  ></app-error-message-modal>
}
